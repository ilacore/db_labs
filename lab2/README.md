# Практика використання сервера Redis

## Скріншоти

* [screenshot1](screenshot1.png)
* [screenshot2](screenshot2.png)

## Обґрунтування структур даних

Дані про користувача зберігаютсья в хешах `user:<id>`. В даній лабораторній роботі це лише ім'я користувача. Також існує хеш `user:username`, який дозволяє отримати id користувача знаючи ім'я. Цей хеш використовуєтся при вході в систему. При цьому створюється ключ `token:<id>` зі значенням `user:<id>` та зі встановленим `expire`

Повідомлення зберігаються в хешах `message:<id>`: відправник, отримувач, текст повідомлення. Для того щоб користувач міг прочитати вхідні повідомлення та подивитись відправлені повідомлення існують множини `message:from:user:<id>`, `message:to:user:<id>`

Для відстеження статусу повідомлень (створено, доставлено, спам) існують відповідні множини. Повідомлення переміщуються між цими множинами за допомогою `smove`

Для відстеження найактивніших користувачів та спамерів використовуються два `ZSET`а.

## Використання

У ролі текстового інтерфейсу використовується інтерактивний режим python: `python3 -i main.py`

`main.py` містить класи які відповідають певним ролям: `User`, `Worker`, `Admin`; клас `Emulate` для емуляції багатьох користувачів, які відправляють повідомлення; а також клас `LoginListener`

---

User

* register(self, username: str)

        Зареєструвати користувача (не виконує вхід в систему)

* login(self, username: str)
* logout(self)
* send(self, username: str, text: str)

        Відсилає повідомлення користувачу `username`

* stats(self)
* inbox(self)

---

Worker

* auto(self)

        Worker працює в автоматичному режимі відмічаючи випадкові повідомлення як спам

* next(self)

        Виводить повідомлення для перевірки на екран  
        Після цього потрібно викликати один з наступних методів
        
* spam(self)

        Відмічає повідомлення як спам
        
* deliver(self)

        Відмічає повідомлення як не спам і доставляє його отримувачу

---

Admin

* get\_usernames(self)

        Виводить імена існуючих користувачів
        
* most\_active(self, n: int)
* spammers(self, n: int)

---

Emulate(usernames: List[str])

* run(self)

---

LoginListener

    Підписується на івенти входу та виходу з системи і оновлює список користувачів в системі

* listen(self)
